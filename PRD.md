
# 📋 PRD: 교사 전용 스마트 자리 배치 플랫폼 '어울림(Eoullim)'

## 1. 프로젝트 개요

* **프로젝트명:** **어울림 (Eoullim)**
* **슬로건:** "자리에서 시작되는 우리 반의 새로운 이야기"
* **목적:** 복잡한 조건을 반영(지정구역, 성별 균형, 고정석 등)하여 교실 자리를 효율적으로 배치하고, **반별 명단을 관리**하는 웹 애플리케이션 구축.
* **타겟 유저:** 초/중/고등학교 교사.

## 2. 기술 스택 (Tech Stack)

| 구분                   | 기술 / 라이브러리                    | 비고                           |
| :--------------------- | :----------------------------------- | :----------------------------- |
| **Frontend**     | Next.js 14+ (App Router), TypeScript | 메인 개발 환경                 |
| **Styling**      | Tailwind CSS                         | 유틸리티 기반 스타일링         |
| **UI Component** | **shadcn/ui**                  | 깔끔하고 모던한 UI 구현에 필수 |
| **Backend/DB**   | Firebase (Auth, Firestore)           | 사용자 인증 및 데이터 저장     |

## 3. 디자인 가이드라인 (Design System)

* **메인 테마:** **Light Blue & White** (Sky-500 계열을 포인트 색상으로 사용).
* **UI/UX:** shadcn/ui 컴포넌트를 활용한 단정하고 전문적인 디자인.
* **레이아웃:**
  * **Landing Page (`/`):** 중앙 정렬된 로고와 슬로건, [Google로 시작하기] 버튼.
  * **Dashboard (`/dashboard`):** 좌측 사이드바(명단 관리/저장 목록) + 우측 메인(작업 공간).

## 4. 주요 기능 명세 (Functional Requirements)

### 4.1. 인증 및 데이터 관리 (Auth & Data)

* **인증:** Firebase Auth를 통한 **Google 로그인**만 지원.
* **DB 구조 핵심:** 명단(`Roster`)과 배치(`Layout`) 정보를 분리하여 관리.
* **명단 관리:** 선생님이 반 이름을 지정하여 학생 명단을 저장하고, 필요한 배치에 명단을 **선택적으로 불러와** 사용 가능.
* **데이터 격리:** 모든 데이터는 로그인된 `userId`에 따라 Firestore에 개별 저장.

### 4.2. 그리드 및 좌석 설정 (Grid & Layout)

* **Custom Grid:** 
  * 기본형: 최대 7x7 (행/열 각각 최대 7)
  * 분단형: 최대 8행, 최대 4분단 (열은 분단 수 × 2로 자동 계산)
  * 모둠형(4인): 고정 6x6
* **Seat Toggle:** 각 셀(Cell) 클릭 시 `Active(좌석)` <-> `Inactive(통로)` 상태 전환.
* **Preset Layouts (버튼):** `5x6 일반형`, `6x5 일반형`, `3분단형 (2열씩 짝 + 통로)` 제공.
* **지정구역 설정:**
  * 여러 개의 지정구역을 생성하고 관리할 수 있음. 각 지정구역은 이름과 색상을 가짐.
  * 지정구역 선택 모드에서 좌석을 클릭하여 해당 구역에 할당.

### 4.3. 학생 명단 입력 및 활용

* **입력 흐름:**
  1. 대시보드에서 **[새 명단 추가]** 또는 **[저장된 명단 불러오기]**를 선택.
  2. 새 명단 추가 시: 반 이름 입력 후 텍스트 영역에 명단 입력 (엑셀 복사 붙여넣기 지원).
* **학생 속성 UI:** 불러온 명단 리스트 옆에 다음 UI 제공:
  * **성별:** 남/여 토글 버튼.

### 4.4. 배치 알고리즘 (Core Logic)

#### A. 유효성 검사 (Validation - 배치 시작 전)

1. 각 지정구역별로 `배정된 학생 수` > `해당 구역 좌석 수` → **Alert Dialog** "지정구역이 부족합니다! 구역을 더 늘려주세요."
2. `총 학생 수` > `총 활성 좌석 수` → **Alert Dialog** "자리가 부족합니다! 책상을 더 활성화해주세요."

#### B. 배치 우선순위

1. **Locked Placement:** 고정된 학생은 자리 유지.
2. **지정구역 배치:** 각 지정구역에 배정된 학생을 해당 구역의 좌석에 랜덤 배치.
3. **Gender Option (조건부):** 좌석이 붙어있는 '분단형' Layout일 경우에만 활성화.
   * 옵션: `남녀 짝`, `동성 짝`, `랜덤`. 성별 조건을 최대한 만족하도록 배치.
4. **Normal Placement:** 남은 학생을 남은 전체 좌석에 랜덤 배치.

### 4.5. 상호작용 및 출력

* **Visual:** 상단 중앙에 '칠판/교탁' 아이콘 고정.
* **수동 조작:**
  * **Swap:** 학생 A 클릭 → 학생 B 클릭 = 위치 교환.
  * **Lock:** 배치된 학생 클릭 시 자물쇠 아이콘 표시로 고정/해제.
* **Animation:** '배치 시작' 클릭 시 룰렛/슬롯머신 효과 애니메이션 적용.
* **인쇄 모드 (Print Preview):**
  * **Teacher View:** 현재 화면 그대로 출력.
  * **Student View:** 전체 좌석 그리드를 **180도 회전(CSS transform)**하여 출력 (학생이 칠판을 보는 방향).

## 5. 데이터 모델 (Firestore Schema)

```json
// users (컬렉션)
//  └─ {userId} (문서)
//
//      ├─ classRosters (서브 컬렉션)  <--- 반별 명단 정보
//      │   └─ {classId} (문서)
//      │       {
//      │         "className": "1학년 3반 (2025학년도)",
//      │         "students": [
//      │           {"id": "s1", "name": "김철수", "gender": "M"},
//      │           {"id": "s2", "name": "이영희", "gender": "F"}
//      │         ]
//      │       }
//
//      └─ layouts (서브 컬렉션)  <--- 저장된 배치 결과
//          └─ {layoutId} (문서)
//              {
//                "title": "중간고사형 배치",
//                "classId": "string", // classRosters의 {classId} FK
//                "config": {
//                  "rows": 6, "cols": 5, "genderOption": "남녀 짝"
//                },
//                "cells": [
//                  { "r": 0, "c": 0, "isActive": true, "zoneId": "zone-1" },
//                ],
//                "config": {
//                  "zones": [
//                    { "id": "zone-1", "name": "앞자리", "color": "yellow" }
//                  ]
//                },
//                "currentAssignment": [
//                  { "seat": {r:0, c:0}, "studentId": "s1", "isLocked": true },
//                  // ... 모든 좌석의 현재 상태
//                ]
//              }
```
